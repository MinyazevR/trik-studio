
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-US">
<head>
<title>Top-down car physics - Box2D tutorials - iforce2d</title>
<meta http-equiv="content-type" content="application/xhtml; charset=UTF-8" />
<link rel="stylesheet" type="text/css" href="/sstyle.css" media="screen, print, projection" />
<link rel="stylesheet" type="text/css" href="/cstyle.css" media="screen, print, projection" />
<link rel="stylesheet" type="text/css" href="/style.css" media="screen, print, projection" />
<script type="text/javascript" src="/js/jquery-1.5.1.min.js"></script>
<script type="text/javascript" src="/js/jquery-ui-1.8.13.custom.min.js"></script>
<script type="text/javascript" src="/js/b2dtut.js"></script>
<!--
<script type="text/javascript" src="/rube/loaders/javascript/box2dweb.js"></script>
<script type="text/javascript" src="/rube/loaders/javascript/loadrube.js"></script>
<script type="text/javascript" src="/js/box2dweb_shortNames.js"></script>
<script type="text/javascript" src="/js/xmasheader.js"></script>
-->
<!--[if !IE 7]>
    <style type="text/css">
      #wrap {display:table;height:100%}
      </style>
<![endif]-->
</head>

<body>

<div id="wrap">

<div id="header">
  

<div class="limitwidth-colored">
  <div style="width:990px;margin:auto">
    <div style="border:1px solid #eee;margin-left:0">
      
      <table style="margin-left:0;border:1px solid #eee;"><tr><td>
      <br />
        <div style="font-size:40px">
          iforce2d
        </div>
      
      </td><td style="text-align:center;width:600px">
      
      <br />
      <br />
      <br />
      <span style="font-size:10px">&lt;# insert awesome header graphics #&gt;</span><br />
      
      </td></tr></table>
      <span style="font-size:14px"> Crushing immovable objects since 2011</span><br />      
      <br />
      
    </div>
  </div>
</div>
<br>

<!--
<div class="limitwidth">  
<canvas id="headercanvas" width="980" height="92">
  <div style="background-color:#eee">
  <div style="width:800px;margin:auto;background-color:#eee;">
    <div style="border:1px solid #eee;margin-left:0">
      
      <table style="margin-left:0;border:1px solid #eee;"><tr><td>
      <br />
        <div style="font-size:40px">
          iforce2d
        </div>
      
      </td><td style="text-align:center;width:600px">
      
      <br />
      <br />
      <br />
      <span style="font-size:8px">&lt;# insert awesome header graphics #&gt;</span><br />
      
      </td></tr></table>
      <span style="font-size:14px"> Crushing immovable objects since 2011</span><br />      
      <br />
      
    </div>
  </div>
  </div>
</canvas>
</div>
<div class="limitwidth" style="text-align:right">
  <a href="#" onclick="pause()">Pause</a>
</div>
-->

<!--
<div class="limitwidth" style="background-color:#b8ffba;border:1px solid gray">
<br>

<div style="text-align:center">
<h2><img style="vertical-align:middle" src="/image/rube_logo2.png" />
Server update notice to R.U.B.E users</h2>
</div>
<br>
<div style="max-width:90%;margin:auto">
This server moved to new hosting on 10th Feb 2022. The R.U.B.E program was updated to use Qt5 and allow 64-bit builds for MacOS.
<br><br>
The system that builds the full version of the program was altered as follows:
<ul>
<li>Linux: 32-bit build no longer available, 64-bit requires GLIBC2.23 (eg. Ubuntu 16.04 <a href="https://gist.github.com/wagenet/35adca1a032cec2999d47b6c40aa45b1">or newer</a>)</li>
<li>MacOS: 32-bit build no longer available, 64-bit added (requires macOS 10.15 Catalina or newer)</li>
<li>Windows: no change</li>
</ul>
If you still require a 32-bit build for Linux or MacOS, you can obtain these from the old server for a while, by temporarily setting the IP address for iforce2d.net to 157.7.166.69 in the hosts file of your computer.
You can find more information about this <a href="https://www.howtogeek.com/howto/27350/beginner-geek-how-to-edit-your-hosts-file/">here</a>. The entries should look like this:<br><br>
<pre style="font-size:1em">    157.7.166.69 iforce2d.net
    157.7.166.69 www.iforce2d.net</pre><br>
You can tell if you're looking at the old server because this big green notice will not be there.<br>
<br>
The old server will be taken offline at the end of February.
<br><br>
</div>
</div>
<br>
-->  <!--<div class="smallspacer">
  </div>-->	
</div>

<div id="topics">
  <!--<div style="color:red;text-align:center">Sep 1 2011 - The server recently suffered a hard drive crash so things are a bit messed up.<br />Some of the download links are missing. Please come back later to try them again.</div><br />-->
<div class="limitwidth">
    <a href="/b2dtut/">Box2D tutorials</a> |
    <a href="/cc2dxres/">Cocos2d-x resources</a> |
    <a href="/b2djson/">Box2D JSON loader</a> |
    <a href="/rube/">R.U.B.E Box2D editor</a> |
    <a href="/rube-free/">R.U.B.E free</a> |
    <a href="/b2dapps/">My apps</a> |
    <a href="/blog/">Blog</a> <span style="font-weight:bold;color:#f00;background-color:#ff0">!</span> |
    <a href="/b2djp/">日本語はこちら</a> |
    <a href="http://ohcoder.com/blog/categories/box2d-tutorials/">Box2D中文教程</a> <!-- |
    <a href="/rp2012/">Ron Paul 2012</a>-->
  </div>


<div style="height:6px"></div>

<!--
<div class="limitwidth-colored">
    <table style="margin-left:0"><tr>
        <td style="width:48px;text-align:center">
            <span style="color:#660099"><b>News</b></span>
        </td>
        <td>
            <span style="color:#900">Mar 20</span>: <img src="/image/window12.png" /> <a href="/rube">R.U.B.E v1.7</a> released. Instanciable objects!<br>
            <span style="color:#900">Feb 21</span>: Added <a href="/rube?panel=loaders">RUBE sample loader for Cocos2d-X v3.4</a>.<br>
            <span style="color:#900">Feb 17</span>: Funny Fists released in <a href="https://itunes.apple.com/us/app/funny-fists/id899838910?ls=1&mt=8">iOS App store</a> and <a href="https://play.google.com/store/apps/details?id=org.iforce2d.funnyfists">Google Play store</a>. (<a href="http://www.youtube.com/watch?v=37TAU85golw">YouTube video</a>)<br>
            
            <span style="color:#609"><b>2014</b></span><br>

            <span style="color:#900">May 25</span>: <a href="/rube">R.U.B.E v1.6</a> released. Samplers!<br>
            <span style="color:#900">May 12</span>: <a href="http://www.iforce2d.net/cc2dxres/otf">"On-the-fly" resource updating for Cocos2d-x</a><br>
            <span style="color:#900">Apr 22</span>: New blog post: <a href="/blog/2014-04-22">Inverted pendulum control</a><br>
            <span style="color:#900">Apr 7</span>: <a href="http://www.iforce2d.net/cc2dxres/screenlog">On-screen logging class for Cocos2d-x</a><br>
            <span style="color:#900">Mar 22</span>: <a href="http://www.downhillsupreme2.com/">Downhill Supreme 2</a> released for iOS and Android<br>
            <span style="color:#900">Jan 2</span>: YouTube video: <a href="http://www.youtube.com/watch?v=F-aDMZUVw0c">Making soft-body wheels in RUBE</a><br>
            
            <span style="color:#609"><b>2013</b></span><br>
            <span style="color:#900">Oct  6</span>: Check out <a href="http://www.youtube.com/watch?v=qow1iONAC3I">Supplyfront RTS</a>, my 7dRTS entry continued.<br>
            <span style="color:#900">Sep 26</span>: <a href="/rube">R.U.B.E v1.5</a> released. Customizable item labels, snap-to-grid, export filtering, full-text help search.<br>
            <span style="color:#900">Sep 18</span>: Added <a href="/rube?panel=loaders">RUBE sample loader for Cocos2d-X</a>.<br>
            
            <div class="morenews">
                <a href="#" class="toggleDivLinkAll" divid="morenews">More...</a><br>
            </div>
            <div class="morenews toggleDivContent">

            
                <span style="color:#900">Sep 16</span>: Updated <a href="/rube?panel=loaders">RUBE sample loader for Cocos2d v2</a>.<br>
                <span style="color:#900">Aug 12</span>: <a href="http://zehfernando.com/2013/loading-and-running-r-u-b-e-scenes-with-nape-as3/">RUBE loader for Nape</a> by Zeh Fernando<br>
                <span style="color:#900">Aug  7</span>: Added <a href="/rube?panel=loaders">RUBE sample loader for SFML</a>.<br>
                <span style="color:#900">Jul 30</span>: Try my MiniLD <a href="http://www.ludumdare.com/compo/minild-44/?action=preview&uid=7091">7dRTS entry</a>.<br>
                <span style="color:#900">Jul 24</span>: Added <a href="/b2dtut/particles">physics-driven particles tutorial</a>.<br>
                <span style="color:#900">Jul 20</span>: New blog post: <a href="/blog/2013-07-20">rendering solid ground</a> (as in Downhill Supreme)<br>            
            
                <span style="color:#900">Jul 18</span>: <a href="/rube">R.U.B.E v1.4</a> released. Command-line interface for batch jobs, hotkeys for scripts, better script management.<br>
                <span style="color:#900">May 22</span>: <a href="http://www.downhillsupreme.com/">Downhill Supreme</a> is out now! (iOS)<br>    
                <span style="color:#900">Apr  2</span>: <a href="/rube">R.U.B.E v1.3</a> released. Collision bitplane editing, Cocos2d-iphone loader, usability improvements.<br>
                <span style="color:#900">Mar 11</span>: <a href="/rube">R.U.B.E v1.2</a> released. Now supports weld, friction, motor joints and automatic image reloading.<br>
                <span style="color:#900">Mar 10</span>: <a href="https://github.com/tescott/RubeLoader">RUBE loader for libGDX</a> by Tim Scott<br>
                <span style="color:#900">Jan 28</span>: New blog post: a functional <a href="/blog/2013-01-28">combustion engine</a>!<br>
                <span style="color:#900">Jan 22</span>: New blog post: <a href="/blog/2013-01-22">wind tunnel</a><br>
                <span style="color:#900">Jan 20</span>: Added <a href="/b2dtut/explosions">explosions tutorial</a>.<br>
                <span style="color:#900">Jan 16</span>: Added <a href="/b2dtut/buoyancy">buoyancy tutorial</a>.<br>
                <span style="color:#900">Jan 16</span>: AndEngine <a href="https://github.com/LouisBHirst/AndEngineJb2dJson">sample project</a> to load RUBE scene by Bart Hirst<br>                
                <span style="color:#900">Jan 14</span>: <a href="/rube">R.U.B.E v1.1</a> released, now supports custom properties.<br>
                <span style="color:#900">Jan 1</span>: All basic tutorials are now available in Chinese at <a href="http://ohcoder.com/blog/categories/box2d-tutorials/">ohcoder.com</a> Huge thankyou to <a href="https://twitter.com/OhCoder">@OhCoder</a>!<br>
                
                <span style="color:#609"><b>2012</b></span><br>
                <span style="color:#900">Dec 23</span>: <a href="/forums">Discussion forums</a> have been set up<br>
                <span style="color:#900">Dec 4</span>: R.U.B.E v1.0 is <a href="/rube">ready</a> !<br>
                <span style="color:#900">Dec 2</span>: YouTube video: <a href="http://www.youtube.com/watch?v=Oc9mzuWyPOI">Box2D pendulum clock</a><br>
                <span style="color:#900">Nov 26</span>: New blog post: <a href="/blog/2012-11-26">rocket platform thingy</a><br>
                <span style="color:#900">Nov 25</span>: <a href="http://www.youtube.com/watch?v=vEZhPpSCAMw">Video</a> of R.U.B.E scenes in Chipmunk.<br>
                <span style="color:#900">Nov 23</span>: A sample project to load R.U.B.E scenes into Chipmunk physics! <a href="/rube?panel=loaders">Details here</a>.<br>
                <span style="color:#900">Nov 14</span>: An XCode sample project to load R.U.B.E scenes on iOS is now available. <a href="/rube?panel=loaders">Details here</a>.<br>
                <span style="color:#900">Nov 11</span>: A Java version of b2dJson is now available, based on <a href="http://www.jbox2d.org/">JBox2D</a>.<br>
                <span style="color:#900">Nov  6</span>: A Javascript version of b2dJson based on box2dweb is now available. <a href="/rube/loaders/javascript">Demo here!</a><br>
                <span style="color:#900">Nov  2</span>: The full specification of the JSON format used by b2dJson can be found here: <a href="/rube/json-structure">b2dJson file structure</a><br>
                <span style="color:#900">Oct 28</span>: YouTube video: <a href="http://www.youtube.com/watch?v=7DXzlE68abA">2-minute ragdoll in R.U.B.E Box2D editor</a><br>
                <span style="color:#900">Sep 29</span>: YouTube video: <a href="http://www.youtube.com/watch?v=-S-pmWLLGrU">R.U.B.E Box2D editor usage example</a><br>                
            </div>
        </td>
    </tr></table>
</div>
-->

<!--<div style="text-align:center">
    <span style="font-weight:bold;color:#f00;background-color:#ff0">New!</span>
    <a href="/rube/loaders/javascript">Box2D vehicles Javascript demo in your browser!</a> 
</div>-->

<div style="height:6px"></div>





</div>


<div id="main">

  <div class="limitwidth-colored">

    <table>
      <tr>
	<td>
	  
   <div id="sidebar">
	  <div id="menu">
   <b>Box2D tutorial topics</b>
<ul class="no-indent">
      <li>
            <a href="introduction">Introduction</a>      </li>
      <li>
            <a href="setup-linux">Setting up (Linux)</a>      </li>
      <li>
            <a href="setup-windows">Setting up (Windows)</a>      </li>
      <li>
            <a href="setup-osx">Setting up (Mac OSX)</a>      </li>
      <li>
            <a href="testbed-structure">Testbed structure</a>      </li>
      <li>
            <a href="making-a-test">Making a test</a>      </li>
      <li>
            <a href="bodies">Bodies</a>      </li>
      <li>
            <a href="fixtures">Fixtures</a>      </li>
      <li>
            <a href="worlds">World settings</a>      </li>
      <li>
            <a href="forces">Forces and impulses</a>      </li>
      <li>
            <a href="custom-gravity">Custom gravity</a>      </li>
      <li>
            <a href="constant-speed">Moving at constant speed</a>      </li>
      <li>
            <a href="rotate-to-angle">Rotating to a given angle</a>      </li>
      <li>
            <a href="jumping">Jumping</a>      </li>
      <li>
            <a href="debug-draw">Using debug draw</a>      </li>
      <li>
            <a href="drawing-objects">Drawing your own objects</a>      </li>
      <li>
            <a href="user-data">User data</a>      </li>
      <li>
            <a href="collision-anatomy">Anatomy of a collision</a>      </li>
      <li>
            <a href="collision-callbacks">Collision callbacks</a>      </li>
      <li>
            <a href="collision-filtering">Collision filtering</a>      </li>
      <li>
            <a href="sensors">Sensors</a>      </li>
      <li>
            <a href="raycasting">Ray casting</a>      </li>
      <li>
            <a href="world-querying">World querying</a>      </li>
      <li>
            <a href="removing-bodies">Removing bodies safely</a>      </li>
      <li>
            <a href="jumpability">The 'can I jump' question</a>      </li>
      <li>
            <a href="ghost-vertices">Ghost vertices</a>      </li>
      <li>
            <a href="joints-overview">Joints - overview</a>      </li>
      <li>
            <a href="joints-revolute">Joints - revolute</a>      </li>
      <li>
            <a href="joints-prismatic">Joints - prismatic</a>      </li>
      <div style="height:5px"></div>
      <hr style="width:60px" />
      <div style="height:3px"></div>
      <li><a href="gotchas">FAQ / gotchas</a></li>
      <div style="height:5px"></div>
      <hr style="width:60px" />
      <div style="height:3px"></div>
      <li><a href="sourcecode">Tutorial source code</a></li>
</ul>

<b>Advanced topics</b>
<ul class="no-indent">
      <li><a href="conveyor-belts">Conveyor belts</a></li>
      <li><a href="projected-trajectory">Projected trajectory</a></li>
      <li><a href="sticky-projectiles">Sticky projectiles</a></li>
      <li><a href="suspension">Hovercar suspension</a></li>
      <li><a href="top-down-car">Top-down car physics</a></li>
      <li><a href="one-way-walls">One-way walls</a></li>
      <li><a href="buoyancy">Buoyancy</a></li>
      <li><a href="explosions">Explosions</a></li>
      <li><a href="particles">Physics-driven particles</a> <!--<span style="font-weight:bold;color:#f00;background-color:#ff0">New!</span>--> </li>
</ul>

<b>Other topics</b>
<ul class="no-indent">
      <li><a href="setup-ios">Setting up (iPhone)</a></li>
</ul>

<!-- <span style="font-weight:bold;color:#f00;background-color:#ff0">New!</span> -->
<!-- <span style="font-weight:bold;color:#f90;background-color:#fff">wip</span> -->
	    <div id="smallspacer">
	    </div>
	  </div><!--menu-->
   </div><!--sidebar-->
	
    <div id="ads">
	<div id="ads">
    <a href="/lama/lama.php?id=8"><img src="/ads/bacterial.jpg" style="padding-top:5px;border-style:none" /></a>
<!--    <a href="/lama/lama.php?id=7"><img src="/ads/ff.jpg" style="padding-top:5px;border-style:none" /></a>-->
    <a href="/lama/lama.php?id=6"><img src="/ads/moldbang.jpg" style="padding-top:5px;border-style:none" /></a>
<!--    <a href="/lama/lama.php?id=5"><img src="/ads/dswoopers.jpg" style="padding-top:5px;border-style:none" /></a> -->
    <a href="/lama/lama.php?id=4"><img src="/ads/orr.jpg" style="padding-top:5px;border-style:none" /></a>
<!--    <a href="/lama/lama.php?id=3"><img src="/ads/dhs.jpg" style="padding-top:5px;border-style:none" /></a> -->
    <!--<a href="/lama/lama.php?id=2"><img src="/ads/adhesion.jpg" style="padding-top:5px;border-style:none" /></a>-->
    <!--<a href="/lama/lama.php?id=1"><img src="/ads/gnomes.jpg" style="padding-top:5px;border-style:none" /></a>-->
    <div class="smallspacer"></div>



<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- testad -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2818479917311013"
     data-ad-slot="4760173888"
     data-ad-format="auto"></ins>


    
</div>
    </div>

	</td>
    <td>	  
      <div id="content">
	
	<div id="blog">
	    <div class="insert-title">
		<h2>Box2D C++ tutorials - Top-down car physics</h2>
		<span style="font-size:0.8em">Last edited: March 19 2014</span>		    
	    </div>
	    <br />
<div style="margin:auto;text-align:center">
  <div style="margin:auto;width:330px;height:58px;border:1px solid;vertical-align:middle">
    <div style="float:left">
    <div style="width:10px;float:left;border:1px solid #fff"></div>
    <img src="/image/flavie.png" />
    </div>
    <span style="font-size:0.9em">
    <br />
      Halt! You should have a good understanding of<br /> the basic tutorials before venturing further.
    </span>
  </div>
</div>
<br />
<br />



<h3>Top-down car physics</h3>
<br />

The discussion of how 'top down' car physics might be implemented in Box2D comes
up fairly often, so I thought I would give it a try and make a topic for it.
Usually a top-down car is modelled in a zero-gravity world, represented by one body
for the chassis and four separate bodies for the wheels. Depending on how realistic
a simulation is required it might be good enough to just use one body for the
chassis and not worry about having separate wheels.<br />
<br />
In either case the crux of the problem is preventing a body from moving in one local axis (tire
should not slide sideways) while still allowing it to move freely in the other
local axis (tire should be able move back and forwards). This in itself is not
such a difficult feat, but the trick is getting it to feel nice for the user when
they control the car. If the lateral velocity is simply killed completely the car
will feel like it's on rails, and we might actually want to allow the car to
skid in some situations, and behave differently on various surfaces etc.
Before we get started you might like to take a look at Doug Koellmer's excellent
implementation of top-down cars in Flash:
<a href="http://quickb2.dougkoellmer.com/bin/qb2DemoReel.swf">qb2DemoReel.swf</a>
(click the 'Next demo' button a couple of times). This is the kind of thing we're
aiming for.<br />
<br />
The basic procedure is to find the current lateral velocity of a body and apply an
impulse that will cancel out that velocity. We will start with just one body to
represent a tire, and later attach four of these to another body for a more complex
simulation. Since all the tires do the same thing we can make a class for them.
Here is the starting point, a class which has a b2Body pointer as a member variable
and sets it up with a simple box shape.
<table class="box2d"><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="de1"><pre class="de1">&nbsp; <span class="kw2">class</span> TDTire <span class="br0">&#123;</span>
&nbsp; <span class="kw2">public</span><span class="sy4">:</span>
&nbsp; &nbsp; &nbsp; <span class="kw4">b2Body</span><span class="sy2">*</span> m_body<span class="sy4">;</span>
&nbsp; 
&nbsp; &nbsp; &nbsp; TDTire<span class="br0">&#40;</span><span class="kw4">b2World</span><span class="sy2">*</span> world<span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw4">b2BodyDef</span> bodyDef<span class="sy4">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bodyDef.<span class="me1">type</span> <span class="sy1">=</span> <span class="kw5">b2_dynamicBody</span><span class="sy4">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_body <span class="sy1">=</span> world<span class="sy2">-</span><span class="sy1">&gt;</span><span class="kw3">CreateBody</span><span class="br0">&#40;</span><span class="sy3">&amp;</span>bodyDef<span class="br0">&#41;</span><span class="sy4">;</span>
&nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw4">b2PolygonShape</span> polygonShape<span class="sy4">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; polygonShape.<span class="me1">SetAsBox</span><span class="br0">&#40;</span> <span class="nu17">0.5f</span>, <span class="nu17">1.25f</span> <span class="br0">&#41;</span><span class="sy4">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_body<span class="sy2">-</span><span class="sy1">&gt;</span><span class="kw3">CreateFixture</span><span class="br0">&#40;</span><span class="sy3">&amp;</span>polygonShape, <span class="nu0">1</span><span class="br0">&#41;</span><span class="sy4">;</span><span class="co1">//shape, density</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_body<span class="sy2">-</span><span class="sy1">&gt;</span>SetUserData<span class="br0">&#40;</span> <span class="kw3">this</span> <span class="br0">&#41;</span><span class="sy4">;</span>
&nbsp; &nbsp; &nbsp; <span class="br0">&#125;</span>
&nbsp; 
&nbsp; &nbsp; &nbsp; ~TDTire<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m_body<span class="sy2">-</span><span class="sy1">&gt;</span>GetWorld<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy2">-</span><span class="sy1">&gt;</span>DestroyBody<span class="br0">&#40;</span>m_body<span class="br0">&#41;</span><span class="sy4">;</span>
&nbsp; &nbsp; &nbsp; <span class="br0">&#125;</span>
&nbsp; <span class="br0">&#125;</span><span class="sy4">;</span></pre></td></tr></tbody></table>Here I have used the shortcut version of CreateFixture which does not require a fixture def.
Note that we've also set the user data of the created b2Body to this class, so the physics
body and the game logic class both have a reference to each other.
<br />
<br />
<br />

<h3>Killing lateral velocity</h3>
<br />
To cancel out the lateral velocity we first need to know what it is. We can find
it by projecting the current velocity of the body onto the current normal vector for the
'sideways' direction of the tire. Let's say that in the local coordinates of the tire
(0,1) will be forwards and (1,0) will be rightwards. We can use GetWorldVector on these
to get the current orientation of these directions in world coordinates.

<img class="ss" alt="Box2D Top-down car physics" src="/image/topdown-localcoords.png" />

For example suppose the tire is rotated a little, and moving upwards as shown in the
next diagram. We want to 'project' the blue vector onto the red one to see how
long it would be if it was only going in the red vector's direction.
<br />

<img class="ss" alt="Box2D Top-down car physics" src="/image/topdown-projectlateral.png" />

So we can add a function like this to the tire class:
<table class="box2d"><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
</pre></td><td class="de1"><pre class="de1">&nbsp; <span class="kw4">b2Vec2</span> getLateralVelocity<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; <span class="kw4">b2Vec2</span> currentRightNormal <span class="sy1">=</span> m_body<span class="sy2">-</span><span class="sy1">&gt;</span>GetWorldVector<span class="br0">&#40;</span> <span class="kw4">b2Vec2</span><span class="br0">&#40;</span><span class="nu0">1</span>,<span class="nu0">0</span><span class="br0">&#41;</span> <span class="br0">&#41;</span><span class="sy4">;</span>
&nbsp; &nbsp; &nbsp; <span class="kw1">return</span> b2Dot<span class="br0">&#40;</span> currentRightNormal, m_body<span class="sy2">-</span><span class="sy1">&gt;</span>GetLinearVelocity<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#41;</span> <span class="sy2">*</span> currentRightNormal<span class="sy4">;</span>
&nbsp; <span class="br0">&#125;</span></pre></td></tr></tbody></table>
Okay, now to apply an impulse to get rid of that part of the velocity. This is very
similar to the final section of the <a href="constant-speed">moving at constant speed</a>
topic where we had a desired velocity, and we applied an impulse multiplied by the mass
of the body to make it reach that velocity in a single time step. Let's add a function to
the tire class that we can call every time step to let it do this:
<table class="box2d"><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
</pre></td><td class="de1"><pre class="de1">&nbsp; <span class="kw4">void</span> updateFriction<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; <span class="kw4">b2Vec2</span> impulse <span class="sy1">=</span> m_body<span class="sy2">-</span><span class="sy1">&gt;</span>GetMass<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy2">*</span> <span class="sy2">-</span>getLateralVelocity<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy4">;</span>
&nbsp; &nbsp; &nbsp; m_body<span class="sy2">-</span><span class="sy1">&gt;</span>ApplyLinearImpulse<span class="br0">&#40;</span> impulse, m_body<span class="sy2">-</span><span class="sy1">&gt;</span>GetWorldCenter<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#41;</span><span class="sy4">;</span>
&nbsp; <span class="br0">&#125;</span></pre></td></tr></tbody></table>At this stage if you create one of these tires bodies in the world and try pushing it
around with the mouse you will notice that the sideways velocity is indeed 'killed' by
this impulse. If you push the tire in the forward direction you
will find that it tends to go around in a circle, almost like a real tire does as when
you roll it and it starts to lose speed.<br />
<br />You will also see that it is still free to
rotate around it's center as much as it likes which is a little unrealistic.
A real car tire doesn't really do that, so let's kill the angular velocity in
a similar way to the lateral velocity. Rotations are a little easier because we
don't have to do that vector projection stuff - add this to the updateFriction function:
<table class="box2d"><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1">&nbsp; m_body<span class="sy2">-</span><span class="sy1">&gt;</span>ApplyAngularImpulse<span class="br0">&#40;</span> <span class="nu17">0.1f</span> <span class="sy2">*</span> m_body<span class="sy2">-</span><span class="sy1">&gt;</span>GetInertia<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy2">*</span> <span class="sy2">-</span>m_body<span class="sy2">-</span><span class="sy1">&gt;</span>GetAngularVelocity<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#41;</span><span class="sy4">;</span></pre></td></tr></tbody></table>The value 0.1 is just something I decided on by playing around with it a bit to
get something that looked like what I remember seeing the last time I spun a car tire
around :) If we killed the rotation completely (try it) the tire looks
like it is on a rail and it can't go anywhere but in a straight line. Another
reason not to completely kill the rotation is that pretty soon
we will want to let the user turn this body to drive it around.<br />
<br />
Finally, you may have noticed that the tire is able to roll on forever in its 'forward'
direction, so let's apply a drag force to make it roll to a stop eventually.
<table class="box2d"><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
</pre></td><td class="de1"><pre class="de1">&nbsp; <span class="kw4">b2Vec2</span> currentForwardNormal <span class="sy1">=</span> getForwardVelocity<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy4">;</span>
&nbsp; <span class="kw4">float</span> currentForwardSpeed <span class="sy1">=</span> currentForwardNormal.<span class="me1">Normalize</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy4">;</span>
&nbsp; <span class="kw4">float</span> dragForceMagnitude <span class="sy1">=</span> <span class="sy2">-</span><span class="nu0">2</span> <span class="sy2">*</span> currentForwardSpeed<span class="sy4">;</span>
&nbsp; m_body<span class="sy2">-</span><span class="sy1">&gt;</span>ApplyForce<span class="br0">&#40;</span> dragForceMagnitude <span class="sy2">*</span> currentForwardNormal, m_body<span class="sy2">-</span><span class="sy1">&gt;</span>GetWorldCenter<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#41;</span><span class="sy4">;</span></pre></td></tr></tbody></table>Once again this goes in updateFriction and the value 2 comes from a bit of fiddling and
tweaking. Of course all you smart people out there automatically knew that getForwardVelocity()
is the same as getLateralVelocity() but works with a local vector of (0,1) instead
of (1,0) right?
<br />
<br />
<br />


<h3>Controlling a tire</h3>
<br />
Before we get to making a car with four tires, we need to take care of a few more
things that a single tire should do. We will at least need to make it move forward
and backwards,
and we would also like it to skid realistically and handle different surfaces too. Let's
focus on getting all of this working well with one tire, then it will be easy to set
up a car with four.<br />
<br />
To test situations where the tire is subject to a variety of movements we can first
pretend that this single tire itself is a car, and let the user rotate it directly.
Here is a basic way of keeping track of which keys (w/a/s/d) the user is
currently pressing:
<table class="box2d"><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="de1"><pre class="de1">&nbsp; <span class="co1">//global scope</span>
&nbsp; <span class="kw5">enum</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; TDC_LEFT &nbsp; <span class="sy1">=</span> <span class="nu12">0x1</span>,
&nbsp; &nbsp; &nbsp; TDC_RIGHT &nbsp;<span class="sy1">=</span> <span class="nu12">0x2</span>,
&nbsp; &nbsp; &nbsp; TDC_UP &nbsp; &nbsp; <span class="sy1">=</span> <span class="nu12">0x4</span>,
&nbsp; &nbsp; &nbsp; TDC_DOWN &nbsp; <span class="sy1">=</span> <span class="nu12">0x8</span>
&nbsp; <span class="br0">&#125;</span><span class="sy4">;</span>
&nbsp; 
&nbsp; <span class="co1">//testbed Test class variable</span>
&nbsp; <span class="kw4">int</span> m_controlState<span class="sy4">;</span>
&nbsp; 
&nbsp; <span class="co1">//testbed Test class constructor</span>
&nbsp; m_controlState <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span>
&nbsp; 
&nbsp; <span class="co1">//testbed Test class functions</span>
&nbsp; <span class="kw4">void</span> Keyboard<span class="br0">&#40;</span><span class="kw4">unsigned</span> <span class="kw4">char</span> key<span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; <span class="kw1">switch</span> <span class="br0">&#40;</span>key<span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">case</span> <span class="st0">'a'</span> <span class="sy4">:</span> m_controlState <span class="sy3">|</span><span class="sy1">=</span> TDC_LEFT<span class="sy4">;</span> &nbsp;<span class="kw1">break</span><span class="sy4">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">case</span> <span class="st0">'d'</span> <span class="sy4">:</span> m_controlState <span class="sy3">|</span><span class="sy1">=</span> TDC_RIGHT<span class="sy4">;</span> <span class="kw1">break</span><span class="sy4">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">case</span> <span class="st0">'w'</span> <span class="sy4">:</span> m_controlState <span class="sy3">|</span><span class="sy1">=</span> TDC_UP<span class="sy4">;</span> &nbsp; &nbsp;<span class="kw1">break</span><span class="sy4">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">case</span> <span class="st0">'s'</span> <span class="sy4">:</span> m_controlState <span class="sy3">|</span><span class="sy1">=</span> TDC_DOWN<span class="sy4">;</span> &nbsp;<span class="kw1">break</span><span class="sy4">;</span>
&nbsp;